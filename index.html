<!DOCTYPE html>
<html lang="en">
<head> 
    <meta charset="UTF-8">
    <title>API index</title>
        <style>
            html{
                background-color: black;
                color: white;
            }
        </style>
</head>
<body>

    <div>
        <h2>Here are some public APIs:</h2>
        This page was made using davemachado's public-api: 
        <a href="https://github.com/davemachado/public-api" 
            target="_blank">https://github.com/davemachado/public-api</a> 
    </div>

    <div>
        <h3>Filter by category</h3>
        <div>
            <button onclick="dataLoader.buttonClick('')">Show All</button>
            <br>
            <br>
            <div id = "buttons">loading...</div>
        </div>
    </div>
    <br>
    <br>

    <div>
        <h3 id = "CatTitle">APIs</h3>
        <div id = "lister">
        loading...
        </div>
    </div>

<script>

    class DataGetter{

        constructor(){
            this.filter = ''
        }

        async loadData (){
            const endpoint = `https://api.publicapis.org/entries?category=${this.filter}&https=true`
            const apis = await fetch(endpoint)
            const file = await apis.json()
            this.data = await file.entries

            const endpointCats = `https://api.publicapis.org/categories`
            const catsFetch = await fetch(endpointCats)
            this.catsData = await catsFetch.json()
        }

        buttonClick(e){
            this.filter = e
            this.renderData()
        }

        async renderButtons(){
            await this.loadData()
            const buttons = document.getElementById('buttons')
            buttons.innerHTML = `
                ${this.catsData
                    .filter(c => !c.includes('&'))
                    .map(c => `
                    <button onclick = "dataLoader.buttonClick('${c}')">${c}</button>
                `).join('')}
            `
        }

        async renderData(){
            await this.loadData()

            const lister = document.getElementById('lister')
            lister.innerHTML = `
                ${Array.from(this.data).map(d =>`
                    <div>${d.API}</div>
                    <div>${d.Description}</div>
                    <div>
                    <a href="${d.Link}" target="_blank">${d.Link}</a>
                    </div>
                `).join('<br>')} 
            `
            
            const title = document.getElementById('CatTitle')
            title.innerHTML = `${this.filter} APIs`
        }
    }

    const dataLoader = new DataGetter()
    dataLoader.renderButtons()
    dataLoader.renderData()
</script>

</body>
</html>
